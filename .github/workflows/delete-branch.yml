name: Delete merged branches

on:
  pull_request:
    types: [closed]

jobs:
  cleanup:
    if: github.event.pull_request.merged == true && github.event.pull_request.head.repo.full_name == github.repository
    runs-on: ubuntu-latest
    permissions:
      contents: write  # needed to delete branch with GITHUB_TOKEN
    steps:
      - name: Delete branch
        run: |
          echo "Deleting branch ${GITHUB_REF_NAME}..."
          BRANCH="${{ github.event.pull_request.head.ref }}"
          OWNER_REPO="${{ github.repository }}"
          curl -s -X DELETE -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/$OWNER_REPO/git/refs/heads/$BRANCH
